$(document).ready(function(){var e,t="",a=!1,i=!1,s=!1,n=!1,o=0,d=0,c=new Howl({src:["assets/sounds/click.ogg"],volume:.35}),r=new Howl({src:["assets/sounds/insert.ogg?v=4"],volume:.3}),p=new Howl({src:["assets/sounds/money.ogg?v=2"],volume:.5}),h=new Howl({src:["assets/sounds/error.ogg?v=2"],volume:.5});function l(e,t){return t=t||0,$(e)[t].getBoundingClientRect().bottom}function y(){c.stop(),h.stop(),p.stop(),r.stop(),$("#error").hide(),$("#card").show(),s=!1,i=!1,a=!1,!1,t="",$("#header").hide(),$("#code").hide(),$("#display").hide(),$("#card").removeClass("card-anim"),$("#card").css("height","150px"),$("#welcome img").attr("src","assets/images/welcome.png"),$("#code").hide(),$("#insert").hide(),$("#code h1").text(""),$("#display").hide(),$("#display #take").hide(),$("#display #insert").hide(),$("#bank #loading").hide(),$("#paper").hide(),window.location.href="index.html",$("#welcome").show()}window.addEventListener("message",function(t){"open"==t.data.action?(n?$.post("http://vrp_banking/error",JSON.stringify({})):($("#wrapper").show(),$("#header p").text(t.data.bank)),o=t.data.cash,d=t.data.bank,e=t.data.code):"openBank"==t.data.action?window.location.href="bank.html?cash="+t.data.cash+"&bank="+t.data.bank+"&type="+t.data.type+"&firstname="+t.data.firstname+"&lastname="+t.data.lastname+"&account="+t.data.account:"close"==t.data.action?$("#wrapper").hide():"correct"==t.data.action&&($("#code").hide(),$("#display").show(),$("#display #take").show())}),$("#cardflash").click(function(){if(!a&&(1069==l("#card")||1253==l("#card"))){$("#card").addClass("card-anim");var t=l("#card"),i=150,s=setInterval(function(){t=l("#card"),i--,t<=648&&(r.play(),clearInterval(s),a=!0,$("#card").css("height",i),$("#card").hide(),"0"==e?$("#welcome img").attr("src","assets/images/welcome_code_new.png"):$("#welcome img").attr("src","assets/images/welcome_code.png"))},1)}}),$("#code-button").click(function(){a&&!s&&$("#code").show()}),$("#b-cancel").click(function(){a&&s&&(c.play(),y(),$("#wrapper").hide(),$.post("http://vrp_banking/escape",JSON.stringify({})))}),$(".take-money").click(function(){if(a&&s){c.play();var e=$(this).attr("data-amount");i?o>0&&s&&($("#display #insert").hide(),$("#display #take").hide(),$("#display").hide(),$("#bank #loading").show(),p.play(),setTimeout(function(){$("#receipt").show(),setTimeout(function(){$("#receipt").attr("src","assets/images/receipt.gif"),$("#receipt").hide(),$("#bank #loading").hide(),$("#display").show(),i&&s?$("#display #insert").show():!i&&s?$("#display #take").show():$("#header").hide(),n=!1,$("#header p").text(parseInt($("#header p").text())+parseInt(e)),$.post("http://vrp_banking/insert",JSON.stringify({money:e})),o=parseInt(o)-parseInt(e),d=parseInt(o)+parseInt(e)},3800)},5600)):n||d>0&&d>e&&(n=!0,$("#display #insert").hide(),$("#display #take").hide(),$("#display").hide(),$("#bank #loading").show(),p.play(),setTimeout(function(){$("#money").show(),$("#receipt").show(),setTimeout(function(){$("#money").attr("src","assets/images/money.gif"),$("#money").hide(),$("#receipt").attr("src","assets/images/receipt.gif"),$("#receipt").hide(),$("#bank #loading").hide(),$("#display").show(),i&&s?$("#display #insert").show():!i&&s?$("#display #take").show():$("#header").hide(),n=!1,s&&($("#header p").text(parseInt($("#header p").text())-parseInt(e)),$.post("http://vrp_banking/take",JSON.stringify({money:e})),o=parseInt(o)+parseInt(e))},3800)},5600))}}),$("body").on("click","#insert-money",function(){c.play(),i?(i=!1,console.log(i),$("#display #insert").hide(),$("#display #take").show()):(i=!0,$("#display #take").hide(),$("#display #insert").show())}),$("#cancel").click(function(){c.play(),y()}),$("#wrong").click(function(){c.play(),$("#code h1").text(""),t=""}),$("#done").click(function(){c.play(),4==t.length&&($("#code").hide(),$("#welcome").hide(),$("#error").hide(),"0"==e&&($.post("http://vrp_banking/setcode",JSON.stringify({setcode:t})),e=t),t==e?($("#bank #loading").show(),setTimeout(function(){$("#bank #loading").hide(),$("#display").show(),$("#display #take").show(),$("#header").show(),s=!0},1e3)):($("#code h1").text(""),t="",$("#error").show(),h.play(),setTimeout(function(){h.stop(),$("#error").hide(),$("#welcome").show()},3e3)))}),$("#small li").click(function(){c.play();var e=$("#code h1").text();4!=e.length&&($("#code h1").text(e+"*"),t+=$(this).text())}),$(document).keyup(function(e){27==e.keyCode&&(y(),$("#wrapper").hide(),$.post("http://vrp_banking/escape",JSON.stringify({})))})});